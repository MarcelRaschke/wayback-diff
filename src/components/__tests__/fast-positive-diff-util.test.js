import {
  removeWBM, normalizeURL, isNotAResource, getLinkFromElement,
  removeDiffXPATH, getTimestampCleanDiff
} from '../false-positive-diff-util.js';

// Utility method to create DOM elements.
function htmlToElement (html) {
  const template = document.createElement('template');
  template.innerHTML = html;
  return template.content.firstChild;
}

test('remove WBM prefix', () => {
  expect(removeWBM('http://web.archive.org/web/20190325071045/https://www.iskme.org/')).toBe('www.iskme.org/');
});

test('normalize URL', () => {
  expect(normalizeURL('http://web.archive.org/web/20190325071045/https://www.iskme.org/')).toBe('http://web.archive.org/web/20190325071045/https://www.iskme.org/');
});

test('get link from element', () => {
  var elem1 = htmlToElement('<a href="http://example.com">example</a>');
  expect(getLinkFromElement(elem1)).toBe('http://example.com/');

  var elem2 = htmlToElement('<div>something</div>');
  expect(getLinkFromElement(elem2)).toBe(undefined);

  var elem3 = htmlToElement('<iframe src="https://ex.com"></iframe>');
  expect(getLinkFromElement(elem3)).toBe('https://ex.com/');
});

test('is not a resource', () => {
  var elem1 = htmlToElement('<a href="http://example.com">example</a>');
  expect(isNotAResource(elem1)).toBe(false);

  var elem2 = htmlToElement('<div>something</div>');
  expect(isNotAResource(elem2)).toBe(true);

  var elem3 = htmlToElement('<iframe src="https://ex.com"></iframe>');
  expect(isNotAResource(elem3)).toBe(false);
});

test('remove diff xpath', () => {
  var xpath1 = '/body[1]/div[2]/p[2]/a[1]/ins[1]';
  expect(removeDiffXPATH(xpath1, 'ins')).toBe('/body[1]/div[2]/p[2]/a[1]');
  var xpath2 = '/body[1]/div[1]/div[1]/div[1]/div[1]/table[1]/tbody[1]/tr[1]/td[2]/table[1]/tbody[1]/tr[3]/td[2]/del[1]';
  expect(removeDiffXPATH(xpath2, 'del')).toBe('/body[1]/div[1]/div[1]/div[1]/div[1]/table[1]/tbody[1]/tr[1]/td[2]/table[1]/tbody[1]/tr[3]/td[2]');
});

// Use real example.com diff outputs to check if `getTimestampCleanDiff` works properly.
test('test getTimestampCleanDiff', () => {
  const insertions = '<!DOCTYPE html>\n<html>\n <head>\n  <script src="//archive.org/includes/analytics.js?v=cf34f82" type="text/javascript">\n  </script>\n  <script type="text/javascript">\n   window.addEventListener(\'DOMContentLoaded\',function(){var v=archive_analytics.values;v.service=\'wb\';v.server_name=\'wwwb-app46.us.archive.org\';v.server_ms=931;archive_analytics.send_pageview({});});\n  </script>\n  <script charset="utf-8" src="/static/js/ait-client-rewrite.js?v=1552816774" type="text/javascript">\n  </script>\n  <script type="text/javascript">\n   WB_wombat_Init("https://web-beta.archive.org/web", "20180222092007", "www.example.com");\n  </script>\n  <script charset="utf-8" src="/static/js/wbhack.js?v=1552816774" type="text/javascript">\n  </script>\n  <script type="text/javascript">\n   __wbhack.init(\'https://web-beta.archive.org/web\');\n  </script>\n  <link href="/static/css/banner-styles.css?v=1552816774" rel="stylesheet" type="text/css"/>\n  <link href="/static/css/iconochive.css?v=1552816774" rel="stylesheet" type="text/css"/>\n  <script src="https://pragma.archivelab.org/static/js/wb-annotate.js" type="text/javascript">\n  </script>\n  <title>\n   Example Domain\n  </title>\n  <meta charset="utf-8"/>\n  <meta content="text/html; charset=utf-8" http-equiv="Content-type"/>\n  <meta content="width=device-width, initial-scale=1" name="viewport"/>\n  <style type="text/css">\n   body {\n        background-color: #f0f0f2;\n        margin: 0;\n        padding: 0;\n        font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;\n        \n    }\n    div {\n        width: 600px;\n        margin: 5em auto;\n        padding: 50px;\n        background-color: #fff;\n        border-radius: 1em;\n    }\n    a:link, a:visited {\n        color: #38488f;\n        text-decoration: none;\n    }\n    @media (max-width: 700px) {\n        body {\n            background-color: #fff;\n        }\n        div {\n            width: auto;\n            margin: 0 auto;\n            border-radius: 0;\n            padding: 1em;\n        }\n    }\n  </style>\n  <style id="wm-diff-style" type="text/css">\n   ins.wm-diff, ins.wm-diff > * {background-color:\n                #1d9efd !important;\n                all: unset;}\n            del.wm-diff, del.wm-diff > * {background-color:\n                #f7f417 !important;\n                all: unset;}\n            script {display: none !important;}\n  </style>\n </head>\n <body>\n  <script charset="utf-8" src="/static/js/timestamp.js?v=1552816774" type="text/javascript">\n  </script>\n  <script charset="utf-8" src="/static/js/graph-calc.js?v=1552816774" type="text/javascript">\n  </script>\n  <script charset="utf-8" src="/static/js/auto-complete.js?v=1552816774" type="text/javascript">\n  </script>\n  <script charset="utf-8" src="/static/js/toolbar.js?v=1552816774" type="text/javascript">\n  </script>\n  <style type="text/css">\n   body {\n  margin-top:0 !important;\n  padding-top:0 !important;\n  /*min-width:800px !important;*/\n}\n.wb-autocomplete-suggestions {\n    text-align: left; cursor: default; border: 1px solid #ccc; border-top: 0; background: #fff; box-shadow: -1px 1px 3px rgba(0,0,0,.1);\n    position: absolute; display: none; z-index: 2147483647; max-height: 254px; overflow: hidden; overflow-y: auto; box-sizing: border-box;\n}\n.wb-autocomplete-suggestion { position: relative; padding: 0 .6em; line-height: 23px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; font-size: 1.02em; color: #333; }\n.wb-autocomplete-suggestion b { font-weight: bold; }\n.wb-autocomplete-suggestion.selected { background: #f0f0f0; }\n  </style>\n  <div id="wm-ipp" lang="en" style="display:none;direction:ltr;">\n   <div style="position:fixed;left:0;top:0;right:0;">\n    <div id="wm-ipp-inside">\n     <div style="position:relative;">\n      <div id="wm-logo" style="float:left;width:130px;padding-top:10px;">\n       <a href="/web/" title="Wayback Machine home page">\n        <img alt="Wayback Machine" border="0" height="39" src="/static/images/toolbar/wayback-toolbar-logo.png" width="110"/>\n       </a>\n      </div>\n      <div class="r" style="float:right;">\n       <div id="wm-btns" style="text-align:right;height:25px;">\n        <div id="wm-save-snapshot-success">\n         success\n        </div>\n        <div id="wm-save-snapshot-fail">\n         fail\n        </div>\n        <a href="#" id="wm-save-snapshot-open" onclick="__wm.saveSnapshot(\'http://www.example.com/\', \'20180222092007\')" title="Share via My Web Archive">\n         <span class="iconochive-web">\n         </span>\n        </a>\n        <a href="https://archive.org/account/login.php" id="wm-sign-in" title="Sign In">\n         <span class="iconochive-person">\n         </span>\n        </a>\n        <span class="iconochive-web" id="wm-save-snapshot-in-progress">\n        </span>\n        <a href="http://faq.web.archive.org/" style="top:-6px;" title="Get some help using the Wayback Machine">\n         <span class="iconochive-question" style="color:rgb(87,186,244);font-size:160%;">\n         </span>\n        </a>\n        <a href="#close" id="wm-tb-close" onclick="__wm.h(event);return false;" style="top:-2px;" title="Close the toolbar">\n         <span class="iconochive-remove-circle" style="color:#888888;font-size:240%;">\n         </span>\n        </a>\n       </div>\n       <div id="wm-share" style="text-align:right;">\n        <a href="#" onclick="window.open(\'https://www.facebook.com/sharer/sharer.php?u=https://web-beta.archive.org/web/20180222092007/http://www.example.com/\', \'\', \'height=400,width=600\'); return false;" style="margin-right:5px;" target="_blank" title="Share on Facebook">\n         <span class="iconochive-facebook" style="color:#3b5998;font-size:160%;">\n         </span>\n        </a>\n        <a href="#" onclick="window.open(\'https://twitter.com/intent/tweet?text=https://web-beta.archive.org/web/20180222092007/http://www.example.com/&amp;via=internetarchive\', \'\', \'height=400,width=600\'); return false;" style="margin-right:5px;" target="_blank" title="Share on Twitter">\n         <span class="iconochive-twitter" style="color:#1dcaff;font-size:160%;">\n         </span>\n        </a>\n       </div>\n      </div>\n      <table class="c" style="">\n       <tbody>\n        <tr>\n         <td class="u" colspan="2">\n          <form action="/web/submit" id="wmtb" method="get" name="wmtb" target="_top">\n           <input id="wmtbURL" name="url" onfocus="this.focus();this.select();" type="text" value="http://www.example.com/"/>\n           <input name="type" type="hidden" value="replay"/>\n           <input name="date" type="hidden" value="20180222092007"/>\n           <input type="submit" value="Go"/>\n          </form>\n         </td>\n         <td class="n" rowspan="2" style="width:110px;">\n          <table>\n           <tbody>\n            <tr class="m">\n             <td class="b" nowrap="nowrap">\n              <a href="https://web-beta.archive.org/web/20180122091735/http://www.example.com/" title="22 Jan 2018">\n               <ins class="wm-diff">\n                <strong>\n                 Jan\n                </strong>\n               </ins>\n              </a>\n             </td>\n             <td class="c" id="displayMonthEl" title="You are here: 09:20:07 Feb 22, 2018">\n              <ins class="wm-diff">\n               FEB\n              </ins>\n             </td>\n             <td class="f" nowrap="nowrap">\n              <a href="https://web-beta.archive.org/web/20180322092431/http://example.com/" title="22 Mar 2018">\n               <ins class="wm-diff">\n                <strong>\n                 Mar\n                </strong>\n               </ins>\n              </a>\n             </td>\n            </tr>\n            <tr class="d">\n             <td class="b" nowrap="nowrap">\n              <a href="https://web-beta.archive.org/web/20180221091126/https://example.com/" title="09:11:26 Feb 21, 2018">\n               <ins class="wm-diff">\n                <img alt="Previous capture" border="0" height="16" src="/static/images/toolbar/wm_tb_prv_on.png" width="14"/>\n               </ins>\n              </a>\n             </td>\n             <td class="c" id="displayDayEl" style="width:34px;font-size:24px;white-space:nowrap;" title="You are here: 09:20:07 Feb 22, 2018">\n              <ins class="wm-diff">\n               22\n              </ins>\n             </td>\n             <td class="f" nowrap="nowrap">\n              <a href="https://web-beta.archive.org/web/20180223092503/http://example.com/" title="09:25:03 Feb 23, 2018">\n               <ins class="wm-diff">\n                <img alt="Next capture" border="0" height="16" src="/static/images/toolbar/wm_tb_nxt_on.png" width="14"/>\n               </ins>\n              </a>\n             </td>\n            </tr>\n            <tr class="y">\n             <td class="b" nowrap="nowrap">\n              <a href="https://web-beta.archive.org/web/20170222085356/http://example.com/" title="22 Feb 2017">\n               <ins class="wm-diff">\n                <strong>\n                 2017\n                </strong>\n               </ins>\n              </a>\n             </td>\n             <td class="c" id="displayYearEl" title="You are here: 09:20:07 Feb 22, 2018">\n              <ins class="wm-diff">\n               2018\n              </ins>\n             </td>\n             <td class="f" nowrap="nowrap">\n              <a href="https://web-beta.archive.org/web/20190222094929/http://www.example.com/" title="22 Feb 2019">\n               <ins class="wm-diff">\n                <strong>\n                 2019\n                </strong>\n               </ins>\n              </a>\n             </td>\n            </tr>\n           </tbody>\n          </table>\n         </td>\n        </tr>\n        <tr>\n         <td class="s">\n          <div id="wm-nav-captures">\n          </div>\n         </td>\n         <td class="k">\n          <a href="" id="wm-graph-anchor">\n           <div id="wm-ipp-sparkline" style="position: relative" title="Explore captures for this URL">\n            <canvas border="0" height="27" id="wm-sparkline-canvas" width="600">\n            </canvas>\n           </div>\n          </a>\n         </td>\n        </tr>\n       </tbody>\n      </table>\n      <div style="position:absolute;bottom:0;right:2px;text-align:right;">\n       <a class="wm-btn wm-closed" href="#expand" id="wm-expand" onclick="__wm.ex(event);return false;">\n        <span class="iconochive-down-solid" id="wm-expand-icon">\n        </span>\n        <span style="font-size:80%">\n         About this capture\n        </span>\n       </a>\n      </div>\n     </div>\n     <div id="wm-capinfo" style="border-top:1px solid #777;display:none; overflow: hidden">\n      <div style="background-color:#666;color:#fff;font-weight:bold;text-align:center">\n       COLLECTED BY\n      </div>\n      <div id="wm-collected-by-content" style="padding:3px;position:relative">\n       <div style="display:inline-block;vertical-align:top;width:50%;">\n        <span class="c-logo" style="background-image:url(https://archive.org/services/img/focused_crawls);">\n        </span>\n        Organization:\n        <a href="https://archive.org/details/focused_crawls" style="color:#33f;" target="_new">\n         <span class="wm-title">\n          Internet Archive\n         </span>\n        </a>\n        <div style="max-height:75px;overflow:hidden;position:relative;">\n         <div style="position:absolute;top:0;left:0;width:100%;height:75px;background:linear-gradient(to bottom,rgba(255,255,255,0) 0%,rgba(255,255,255,0) 90%,rgba(255,255,255,255) 100%);">\n         </div>\n         Focused crawls are collections of frequently-updated webcrawl data from narrow (as opposed to broad or wide) web crawls, often focused on a single domain or subdomain.\n         <br/>\n        </div>\n       </div>\n       <div style="display:inline-block;vertical-align:top;width:49%;">\n        <span class="c-logo" style="background-image:url(https://archive.org/services/img/top_domains-07250)">\n        </span>\n        <div>\n         Collection:\n         <a href="https://archive.org/details/top_domains-07250" style="color:#33f;" target="_new">\n          <ins class="wm-diff">\n           <span class="wm-title">\n            top_domains-07250\n           </span>\n          </ins>\n         </a>\n        </div>\n       </div>\n      </div>\n      <div style="background-color:#666;color:#fff;font-weight:bold;text-align:center" title="Timestamps for the elements of this page">\n       <ins class="wm-diff">\n        TIMESTAMPS\n       </ins>\n      </div>\n      <div>\n       <div id="wm-capresources" style="margin:0 5px 5px 5px;max-height:250px;overflow-y:scroll !important">\n       </div>\n       <div id="wm-capresources-loading" style="text-align:left;margin:0 20px 5px 5px;display:none">\n        <ins class="wm-diff">\n         <img alt="loading" src="/static/images/loading.gif"/>\n        </ins>\n       </div>\n      </div>\n     </div>\n    </div>\n   </div>\n  </div>\n  <ins class="wm-diff">\n   <script type="text/javascript">\n    __wm.bt(600,27,25,2,"web","http://www.example.com/","2018-02-22",1996,"/static/");\n   </script>\n  </ins>\n  <div>\n   <h1>\n    Example Domain\n   </h1>\n   <p>\n    This domain is established to be used for illustrative examples in documents. You may use this\n    domain in examples without prior coordination or asking for permission.\n   </p>\n   <p>\n    <a href="https://web-beta.archive.org/web/20180222092007/http://www.iana.org/domains/example">\n     More information...\n     <ins class="wm-diff">\n     </ins>\n    </a>\n   </p>\n  </div>\n  <script id="wm-diff-script">\n   (function () {\n        // Update the text color of change elements to ensure a readable level\n        // of contrast with the background color\n        function parseColor (colorString) {\n            const components = colorString.match(/rgba?\\(\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*(\\d+)\\s*(?:,\\s*(\\d+)\\s*)?\\)/);\n            return {\n                red: Number(components[1]),\n                green: Number(components[2]),\n                blue: Number(components[3]),\n                alpha: components[4] == null ? 1 : Number(components[4])\n            };\n        }\n\n        function normalizeChannel (integerValue) {\n            const scaled = integerValue / 255;\n            if (scaled < 0.03928) {\n                return scaled / 12.92;\n            }\n            return Math.pow((scaled + 0.055) / 1.055, 2.4);\n        }\n\n        // See https://www.w3.org/TR/WCAG/#relativeluminancedef\n        function srgbRelativeLuminance (color) {\n            return 0.2126 * normalizeChannel(color.red)\n                + 0.7152 * normalizeChannel(color.green)\n                + 0.0722 * normalizeChannel(color.blue);\n        }\n\n        // See https://www.w3.org/TR/WCAG/#contrast-ratiodef\n        function contrastRatio (a, b) {\n            const luminanceA = srgbRelativeLuminance(a) + 0.05;\n            const luminanceB = srgbRelativeLuminance(b) + 0.05;\n            return Math.max(luminanceA, luminanceB) / Math.min(luminanceA, luminanceB);\n        }\n\n        document.querySelectorAll(\'ins,del\').forEach(element => {\n            const color = parseColor(getComputedStyle(element).color);\n            const background = parseColor(getComputedStyle(element).backgroundColor);\n            if (contrastRatio(color, background) < 4) {\n                element.style.color = \'#000\';\n            }\n        });\n    })();\n  </script>\n </body>\n</html>\n';
  const deletions = '<!DOCTYPE html>\n<html>\n <head>\n  <script src="//archive.org/includes/analytics.js?v=cf34f82" type="text/javascript">\n  </script>\n  <script type="text/javascript">\n   window.addEventListener(\'DOMContentLoaded\',function(){var v=archive_analytics.values;v.service=\'wb\';v.server_name=\'wwwb-app47.us.archive.org\';v.server_ms=646;archive_analytics.send_pageview({});});\n  </script>\n  <script charset="utf-8" src="/static/js/ait-client-rewrite.js?v=1552816774" type="text/javascript">\n  </script>\n  <script type="text/javascript">\n   WB_wombat_Init("https://web-beta.archive.org/web", "20180101001551", "example.com");\n  </script>\n  <script charset="utf-8" src="/static/js/wbhack.js?v=1552816774" type="text/javascript">\n  </script>\n  <script type="text/javascript">\n   __wbhack.init(\'https://web-beta.archive.org/web\');\n  </script>\n  <link href="/static/css/banner-styles.css?v=1552816774" rel="stylesheet" type="text/css"/>\n  <link href="/static/css/iconochive.css?v=1552816774" rel="stylesheet" type="text/css"/>\n  <script src="https://pragma.archivelab.org/static/js/wb-annotate.js" type="text/javascript">\n  </script>\n  <title>\n   Example Domain\n  </title>\n  <meta charset="utf-8"/>\n  <meta content="text/html; charset=utf-8" http-equiv="Content-type"/>\n  <meta content="width=device-width, initial-scale=1" name="viewport"/>\n  <style type="text/css">\n   body {\n        background-color: #f0f0f2;\n        margin: 0;\n        padding: 0;\n        font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;\n        \n    }\n    div {\n        width: 600px;\n        margin: 5em auto;\n        padding: 50px;\n        background-color: #fff;\n        border-radius: 1em;\n    }\n    a:link, a:visited {\n        color: #38488f;\n        text-decoration: none;\n    }\n    @media (max-width: 700px) {\n        body {\n            background-color: #fff;\n        }\n        div {\n            width: auto;\n            margin: 0 auto;\n            border-radius: 0;\n            padding: 1em;\n        }\n    }\n  </style>\n  <style id="wm-diff-style" type="text/css">\n   ins.wm-diff, ins.wm-diff > * {background-color:\n                #1d9efd !important;\n                all: unset;}\n            del.wm-diff, del.wm-diff > * {background-color:\n                #f7f417 !important;\n                all: unset;}\n            script {display: none !important;}\n  </style>\n </head>\n <body>\n  <script charset="utf-8" src="/static/js/timestamp.js?v=1552816774" type="text/javascript">\n  </script>\n  <script charset="utf-8" src="/static/js/graph-calc.js?v=1552816774" type="text/javascript">\n  </script>\n  <script charset="utf-8" src="/static/js/auto-complete.js?v=1552816774" type="text/javascript">\n  </script>\n  <script charset="utf-8" src="/static/js/toolbar.js?v=1552816774" type="text/javascript">\n  </script>\n  <style type="text/css">\n   body {\n  margin-top:0 !important;\n  padding-top:0 !important;\n  /*min-width:800px !important;*/\n}\n.wb-autocomplete-suggestions {\n    text-align: left; cursor: default; border: 1px solid #ccc; border-top: 0; background: #fff; box-shadow: -1px 1px 3px rgba(0,0,0,.1);\n    position: absolute; display: none; z-index: 2147483647; max-height: 254px; overflow: hidden; overflow-y: auto; box-sizing: border-box;\n}\n.wb-autocomplete-suggestion { position: relative; padding: 0 .6em; line-height: 23px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; font-size: 1.02em; color: #333; }\n.wb-autocomplete-suggestion b { font-weight: bold; }\n.wb-autocomplete-suggestion.selected { background: #f0f0f0; }\n  </style>\n  <div id="wm-ipp" lang="en" style="display:none;direction:ltr;">\n   <div style="position:fixed;left:0;top:0;right:0;">\n    <div id="wm-ipp-inside">\n     <div style="position:relative;">\n      <div id="wm-logo" style="float:left;width:130px;padding-top:10px;">\n       <a href="/web/" title="Wayback Machine home page">\n        <img alt="Wayback Machine" border="0" height="39" src="/static/images/toolbar/wayback-toolbar-logo.png" width="110"/>\n       </a>\n      </div>\n      <div class="r" style="float:right;">\n       <div id="wm-btns" style="text-align:right;height:25px;">\n        <div id="wm-save-snapshot-success">\n         success\n        </div>\n        <div id="wm-save-snapshot-fail">\n         fail\n        </div>\n        <a href="#" id="wm-save-snapshot-open" onclick="__wm.saveSnapshot(\'http://example.com/\', \'20180101001551\')" title="Share via My Web Archive">\n         <span class="iconochive-web">\n         </span>\n        </a>\n        <a href="https://archive.org/account/login.php" id="wm-sign-in" title="Sign In">\n         <span class="iconochive-person">\n         </span>\n        </a>\n        <span class="iconochive-web" id="wm-save-snapshot-in-progress">\n        </span>\n        <a href="http://faq.web.archive.org/" style="top:-6px;" title="Get some help using the Wayback Machine">\n         <span class="iconochive-question" style="color:rgb(87,186,244);font-size:160%;">\n         </span>\n        </a>\n        <a href="#close" id="wm-tb-close" onclick="__wm.h(event);return false;" style="top:-2px;" title="Close the toolbar">\n         <span class="iconochive-remove-circle" style="color:#888888;font-size:240%;">\n         </span>\n        </a>\n       </div>\n       <div id="wm-share" style="text-align:right;">\n        <a href="#" onclick="window.open(\'https://www.facebook.com/sharer/sharer.php?u=https://web-beta.archive.org/web/20180101001551/http://example.com/\', \'\', \'height=400,width=600\'); return false;" style="margin-right:5px;" target="_blank" title="Share on Facebook">\n         <span class="iconochive-facebook" style="color:#3b5998;font-size:160%;">\n         </span>\n        </a>\n        <a href="#" onclick="window.open(\'https://twitter.com/intent/tweet?text=https://web-beta.archive.org/web/20180101001551/http://example.com/&amp;via=internetarchive\', \'\', \'height=400,width=600\'); return false;" style="margin-right:5px;" target="_blank" title="Share on Twitter">\n         <span class="iconochive-twitter" style="color:#1dcaff;font-size:160%;">\n         </span>\n        </a>\n       </div>\n      </div>\n      <table class="c" style="">\n       <tbody>\n        <tr>\n         <td class="u" colspan="2">\n          <form action="/web/submit" id="wmtb" method="get" name="wmtb" target="_top">\n           <input id="wmtbURL" name="url" onfocus="this.focus();this.select();" type="text" value="http://example.com/"/>\n           <input name="type" type="hidden" value="replay"/>\n           <input name="date" type="hidden" value="20180101001551"/>\n           <input type="submit" value="Go"/>\n          </form>\n         </td>\n         <td class="n" rowspan="2" style="width:110px;">\n          <table>\n           <tbody>\n            <tr class="m">\n             <td class="b" nowrap="nowrap">\n              <a href="https://web-beta.archive.org/web/20171201000940/http://example.com/" title="01 Dec 2017">\n               <del class="wm-diff">\n                <strong>\n                 Dec\n                </strong>\n               </del>\n              </a>\n             </td>\n             <td class="c" id="displayMonthEl" title="You are here: 00:15:51 Jan 01, 2018">\n              <del class="wm-diff">\n               JAN\n              </del>\n             </td>\n             <td class="f" nowrap="nowrap">\n              <a href="https://web-beta.archive.org/web/20180201004054/http://example.com/" title="01 Feb 2018">\n               <del class="wm-diff">\n                <strong>\n                 Feb\n                </strong>\n               </del>\n              </a>\n             </td>\n            </tr>\n            <tr class="d">\n             <td class="b" nowrap="nowrap">\n              <a href="https://web-beta.archive.org/web/20171230235058/http://example.com/" title="23:50:58 Dec 30, 2017">\n               <del class="wm-diff">\n                <img alt="Previous capture" border="0" height="16" src="/static/images/toolbar/wm_tb_prv_on.png" width="14"/>\n               </del>\n              </a>\n             </td>\n             <td class="c" id="displayDayEl" style="width:34px;font-size:24px;white-space:nowrap;" title="You are here: 00:15:51 Jan 01, 2018">\n              <del class="wm-diff">\n               01\n              </del>\n             </td>\n             <td class="f" nowrap="nowrap">\n              <a href="https://web-beta.archive.org/web/20180102002013/http://example.com/" title="00:20:13 Jan 02, 2018">\n               <del class="wm-diff">\n                <img alt="Next capture" border="0" height="16" src="/static/images/toolbar/wm_tb_nxt_on.png" width="14"/>\n               </del>\n              </a>\n             </td>\n            </tr>\n            <tr class="y">\n             <td class="b" nowrap="nowrap">\n              <a href="https://web-beta.archive.org/web/20161231235705/http://example.com/" title="31 Dec 2016">\n               <del class="wm-diff">\n                <strong>\n                 2016\n                </strong>\n               </del>\n              </a>\n             </td>\n             <td class="c" id="displayYearEl" title="You are here: 00:15:51 Jan 01, 2018">\n              <del class="wm-diff">\n               2018\n              </del>\n             </td>\n             <td class="f" nowrap="nowrap">\n              <a href="https://web-beta.archive.org/web/20190101002807/http://example.com/" title="01 Jan 2019">\n               <del class="wm-diff">\n                <strong>\n                 2019\n                </strong>\n               </del>\n              </a>\n             </td>\n            </tr>\n           </tbody>\n          </table>\n         </td>\n        </tr>\n        <tr>\n         <td class="s">\n          <div id="wm-nav-captures">\n          </div>\n         </td>\n         <td class="k">\n          <a href="" id="wm-graph-anchor">\n           <div id="wm-ipp-sparkline" style="position: relative" title="Explore captures for this URL">\n            <canvas border="0" height="27" id="wm-sparkline-canvas" width="600">\n            </canvas>\n           </div>\n          </a>\n         </td>\n        </tr>\n       </tbody>\n      </table>\n      <div style="position:absolute;bottom:0;right:2px;text-align:right;">\n       <a class="wm-btn wm-closed" href="#expand" id="wm-expand" onclick="__wm.ex(event);return false;">\n        <span class="iconochive-down-solid" id="wm-expand-icon">\n        </span>\n        <span style="font-size:80%">\n         About this capture\n        </span>\n       </a>\n      </div>\n     </div>\n     <div id="wm-capinfo" style="border-top:1px solid #777;display:none; overflow: hidden">\n      <div style="background-color:#666;color:#fff;font-weight:bold;text-align:center">\n       COLLECTED BY\n      </div>\n      <div id="wm-collected-by-content" style="padding:3px;position:relative">\n       <div style="display:inline-block;vertical-align:top;width:50%;">\n        <span class="c-logo" style="background-image:url(https://archive.org/services/img/focused_crawls);">\n        </span>\n        Organization:\n        <a href="https://archive.org/details/focused_crawls" style="color:#33f;" target="_new">\n         <span class="wm-title">\n          Internet Archive\n         </span>\n        </a>\n        <div style="max-height:75px;overflow:hidden;position:relative;">\n         <div style="position:absolute;top:0;left:0;width:100%;height:75px;background:linear-gradient(to bottom,rgba(255,255,255,0) 0%,rgba(255,255,255,0) 90%,rgba(255,255,255,255) 100%);">\n         </div>\n         Focused crawls are collections of frequently-updated webcrawl data from narrow (as opposed to broad or wide) web crawls, often focused on a single domain or subdomain.\n         <br/>\n        </div>\n       </div>\n       <div style="display:inline-block;vertical-align:top;width:49%;">\n        <span class="c-logo" style="background-image:url(https://archive.org/services/img/google.se)">\n        </span>\n        <div>\n         Collection:\n         <a href="https://archive.org/details/google.se" style="color:#33f;" target="_new">\n          <del class="wm-diff">\n           <span class="wm-title">\n            google.se\n           </span>\n          </del>\n         </a>\n        </div>\n       </div>\n      </div>\n      <div style="background-color:#666;color:#fff;font-weight:bold;text-align:center" title="Timestamps for the elements of this page">\n       <del class="wm-diff">\n        TIMESTAMPS\n       </del>\n      </div>\n      <div>\n       <div id="wm-capresources" style="margin:0 5px 5px 5px;max-height:250px;overflow-y:scroll !important">\n       </div>\n       <div id="wm-capresources-loading" style="text-align:left;margin:0 20px 5px 5px;display:none">\n        <del class="wm-diff">\n         <img alt="loading" src="/static/images/loading.gif"/>\n        </del>\n       </div>\n      </div>\n     </div>\n    </div>\n   </div>\n  </div>\n  <del class="wm-diff">\n   <script type="text/javascript">\n    __wm.bt(600,27,25,2,"web","http://example.com/","2018-01-01",1996,"/static/");\n   </script>\n  </del>\n  <div>\n   <h1>\n    Example Domain\n   </h1>\n   <p>\n    This domain is established to be used for illustrative examples in documents. You may use this\n    domain in examples without prior coordination or asking for permission.\n   </p>\n   <p>\n    <a href="https://web-beta.archive.org/web/20180101001551/http://www.iana.org/domains/example">\n     More information...\n     <del class="wm-diff">\n     </del>\n    </a>\n   </p>\n  </div>\n  <script id="wm-diff-script">\n   (function () {\n        // Update the text color of change elements to ensure a readable level\n        // of contrast with the background color\n        function parseColor (colorString) {\n            const components = colorString.match(/rgba?\\(\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*(\\d+)\\s*(?:,\\s*(\\d+)\\s*)?\\)/);\n            return {\n                red: Number(components[1]),\n                green: Number(components[2]),\n                blue: Number(components[3]),\n                alpha: components[4] == null ? 1 : Number(components[4])\n            };\n        }\n\n        function normalizeChannel (integerValue) {\n            const scaled = integerValue / 255;\n            if (scaled < 0.03928) {\n                return scaled / 12.92;\n            }\n            return Math.pow((scaled + 0.055) / 1.055, 2.4);\n        }\n\n        // See https://www.w3.org/TR/WCAG/#relativeluminancedef\n        function srgbRelativeLuminance (color) {\n            return 0.2126 * normalizeChannel(color.red)\n                + 0.7152 * normalizeChannel(color.green)\n                + 0.0722 * normalizeChannel(color.blue);\n        }\n\n        // See https://www.w3.org/TR/WCAG/#contrast-ratiodef\n        function contrastRatio (a, b) {\n            const luminanceA = srgbRelativeLuminance(a) + 0.05;\n            const luminanceB = srgbRelativeLuminance(b) + 0.05;\n            return Math.max(luminanceA, luminanceB) / Math.min(luminanceA, luminanceB);\n        }\n\n        document.querySelectorAll(\'ins,del\').forEach(element => {\n            const color = parseColor(getComputedStyle(element).color);\n            const background = parseColor(getComputedStyle(element).backgroundColor);\n            if (contrastRatio(color, background) < 4) {\n                element.style.color = \'#000\';\n            }\n        });\n    })();\n  </script>\n </body>\n</html>\n';
  const out = getTimestampCleanDiff(insertions, deletions);

  const originalInsCnt = (insertions.match(/<ins/g) || []).length;
  const finalInsCnt = (out.insertions.match(/<ins/g) || []).length;
  expect(finalInsCnt).toBe(originalInsCnt - 7);

  const originalDelCnt = (deletions.match(/<del/g) || []).length;
  const finalDelCnt = (out.deletions.match(/<del/g) || []).length;
  expect(finalDelCnt).toBe(originalDelCnt - 7);
});
